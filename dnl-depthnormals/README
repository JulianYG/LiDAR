=========================================================================
Depth Map Prediction from a Single Image using a Multi-Scale Deep Network
=========================================================================

Authors: David Eigen, Christian Puhrsch and Rob Fergus

Email:   deigen@cs.nyu.edu, cpuhrsch@nyu.edu, fergus@cs.nyu.edu


Requirements
-------------

* theano
* numpy, scipy
* PIL or Pillow


Running the Demo
-----------------

The demo loads the depth prediction network, compiles a theano function for
inference, and infers depth for a single image.  To run:

>THEANO_FLAGS='floatX=float32,device=gpu0' python demo_depthnormals.py

This should create a file called "demo_nyud_depth_prediction.png" with the
predicted depth for the input "demo_nyud_rgb.jpg".  (Substitute the gpu you
want to run on for gpu0).



Other Information
------------------

This tree contains code for depth prediction network inference.  While there is
some code relating to training, much of the training code including most data
processing is not provided here.  We may release this in the future, however.

While developing this project, we made a few modifications in theano not
currently part of the main codeline.  While the above instructions should work
for inference on a current unmodified theano build, it may take up more GPU
memory than needed due to use of test values for shape information.  The git
patch file "theano_test_value_size.patch" is also included and might be used to
enable this feature on your own tree.


========================================
by yolanda, pipeline comments
========================================
# initialize net
module_fn = 'models/iccv15/%s.py' % model_name
config_fn = 'models/iccv15/%s.conf' % model_name
params_dir = 'weights/iccv15/%s' % model_name
machine = net.create_machine(module_fn, config_fn, params_dir)

# test
(pred_depths, pred_normals) = machine.infer_depth_and_normals(rgb_imgs)
# run network
pred_depths = self.inverse_depth_transform(self.scale3.depths.pred_mean)
pred_normals = self.scale3.normals.pred_mean
infer_f = theano.function([v.images], (pred_depths, pred_normals))
# theano.function {inputs, outputs, updates}
# more brief theano tutorial: http://cs231n.stanford.edu/slides/winter1516_lecture12.pdf
